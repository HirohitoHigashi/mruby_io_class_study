# GPIO

## 方針、リクエストなど

* MicroPythonに準じ、「どのピンか？」及び「その属性」を、コンストラクタで指定できるようにする。
* 読み込みは気軽に、書き込みは慎重にとの経験則から、読み込みと書き込みのメソッドは分離する。
* ハードウェアは負論理で設計されることも多いので、単純なON/OFFが逆の意味を持つことがあることに気をつける。
* しかし値に関して、1 == High == 3.3V(例) という知識は、外部が負論理で設計されていても疑問に思う人はほぼいないだろうという事実は利用する。
* 動作途中での属性変更も可能とする。（田中）
* 動作途中での属性変更時は、プルアップ・プルダウンのクリアするかについて仕様に盛り込む。（羽角）
* Rubyらしく記述するために、読み込み値の boolean な判定が欲しい。（羽角）
* GPIOは機能が単純なので、オブジェクトを作らなくてもクラスメソッドで対応することができるとなお良い。（羽角）

--------------------------------------------------------------------------------
# コンストラクタ
```
GPIO.new( pin, modes... )
```

* pin の指定は基本的には整数で指定するが、別な方法（例えばPICでは"B1"等）があっても良い。
* 1ビットを基本とするが、機器によっては必要に応じて複数ビットまとめたピン指定もありうる。
* modes は、クラスに用意した定数で行う。
* 全ての機器で modes の機能が用意されているわけではない。

### 例
```
# ピン番号1を出力に設定する。
gpoi1 = GPIO.new( 1, GPIO::OUT )

# B1ピンを入力、内部プルアップに設定する。（PIC等）
gpio1 = GPIO.new( "B1", GPIO::IN, GPIO::PULL_UP )
```

### モードに設定する定数

```
GPIO::IN            # 入力に設定する
GPIO::OUT           # 出力に設定する
GPIO::HIGH_Z        # ハイインピーダンスに設定する
GPIO::PULL_UP       # 内部プルアップを有効にする
GPIO::PULL_DOWN     # 内部プルダウンを有効にする
GPIO::OPEN_DRAIN    # オープンドレインモードに設定する
```

--------------------------------------------------------------------------------
# クラスメソッド

## 入力
```
read_at( pin )
```

* コンストラクタと同様のピン指定で、値の読み込みを行う。

### 例
```
GPIO.new( 1, GPIO::IN )
v1 = GPIO.read_at( 1 )
```

----------------------------------------
## 出力
```
write_at( pin )
```

* コンストラクタと同様のピン指定で、値の出力を行う。

### 例
```
GPIO.new( 1, GPIO::OUT )
v1 = GPIO.write_at( 1 )
```

--------------------------------------------------------------------------------
# インスタンスメソッド
## モード設定
```
setmode( modes... )
```

* GPIOのモードを任意のタイミングで変更する。
* IN,OUT もしくは HIGH_Z が指定された場合（変更された場合ではなく）は、その他の設定クリアされる。

### 例
```
# 内部プルアップを有効にする
gpio1.setmode( GPIO::PULL_UP )

# 入力に切り替え、内部プルアップを有効にする。
gpio1.setmode( GPIO::IN, GPIO::PULL_UP )
```

----------------------------------------
## 入力
```
read() -> Integer
```

* 読み込んだ値を、0または1で返す。
* 複数ビットまとめて扱う実装の場合のみ、任意の整数になりうる。
* 出力に設定したピンに対して read する場合は、ハードウェアが許せば、設定値ではなく実際の値を読んで返すべき。
* origin: POSIX

### 例
```
v1 = gpio1.read()
```

----------------------------------------
## 入力値がハイレベルか？
```
high?() -> bool
```

* 読み込んだ値が、ハイレベル (==1) かを、true または false で返す。

### 例
```
if gpio1.high?()
```

----------------------------------------
## 入力値がローレベルか？
```
low?() -> bool
```

* 読み込んだ値が、ローレベル (==0) かを、true または false で返す。

### 例
```
if gpio1.low?()
```

----------------------------------------
## 出力
```
write( Integer )
```

* 出力する値を、0または1で指示する。
* 複数ビットまとめて扱う実装の場合のみ、任意の整数で指示する。
* origin: POSIX
  
### 例
```
gpio1.write( 1 )
```
